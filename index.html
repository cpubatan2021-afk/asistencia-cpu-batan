<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Asistencia - CPU</title>
    <style>
        :root {
            --bg-dark: #121212;
            --bg-light: #1e1e1e;
            --text-primary: #e0e0e0;
            --text-secondary: #b0b0b0;
            --accent: #667eea;
            --accent-secondary: #f093fb;
            --success: #43e97b;
            --danger: #ff4757;
            --warning: #fee140;
            --shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        .header {
            background-color: var(--bg-light);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            position: relative;
        }
        .header h1 {
            color: var(--accent);
            margin: 0;
            font-size: 2.5em;
            text-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .logo-cpu {
            width: 80px;
            height: auto;
            margin-right: 10px;
        }
        .clock {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 18px;
            color: var(--text-secondary);
            background-color: rgba(0, 0, 0, 0.3);
            padding: 8px 15px;
            border-radius: 8px;
            font-family: monospace;
        }
        .layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }
        .sidebar {
            background-color: var(--bg-light);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
        }
        .sidebar h2 {
            color: var(--accent);
            margin: 0 0 15px 0;
        }
        .materia-list {
            margin-bottom: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
        .materia-item {
            position: relative;
            margin-bottom: 8px;
        }
        .materia-btn {
            width: 100%;
            padding: 12px;
            padding-right: 40px;
            background-color: var(--accent-secondary);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            text-align: left;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .materia-btn.active {
            background-color: var(--accent);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.7);
        }
        .materia-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        .delete-materia {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
        }
        .btn-nueva {
            width: 100%;
            padding: 12px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            margin-top: 10px;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .btn-nueva:hover {
            background-color: #5a6fd1;
            transform: translateY(-2px);
        }
        .content {
            background-color: var(--bg-light);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
        }
        /* Carousel */
        .carousel-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
            overflow: hidden;
            border-radius: 15px;
            box-shadow: var(--shadow);
            height: 300px;
        }
        .carousel-slides {
            position: relative;
            width: 100%;
            height: 100%;
        }
        .carousel-slide {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            color: white;
            text-align: center;
            padding: 40px 20px;
            box-sizing: border-box;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
            background-size: cover;
            background-position: center;
        }
        .carousel-slide.active {
            display: flex;
            opacity: 1;
        }
        .carousel-slide h3 {
            font-size: 24px;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
        }
        .carousel-slide p {
            font-size: 18px;
            opacity: 0.9;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
        }
        .carousel-slide .slide-icon {
            font-size: 50px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
        }
        .carousel-controls {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .carousel-controls button {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin: 0 10px;
            cursor: pointer;
            font-size: 18px;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .carousel-controls button:hover {
            transform: scale(1.1);
        }
        .carousel-dots {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }
        .carousel-dots span {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--text-secondary);
            margin: 0 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        .carousel-dots span.active {
            background: var(--accent);
            transform: scale(1.2);
        }
        .empty-instruction {
            text-align: center;
            margin-top: 30px;
            color: var(--text-secondary);
            font-size: 18px;
        }
        .empty-instruction strong {
            color: var(--accent);
        }
        /* Modal para tipo de materia */
        .modal-tipo {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }
        .modal-tipo-content {
            background-color: var(--bg-light);
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--accent);
            width: 50%;
            max-width: 400px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        .modal-tipo-content h3 {
            color: var(--accent);
            margin-top: 0;
            margin-bottom: 20px;
        }
        .tipo-materia-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .tipo-materia-option {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
        }
        .tipo-materia-option.extension {
            background-color: var(--accent);
            color: white;
        }
        .tipo-materia-option.taller {
            background-color: var(--accent-secondary);
            color: white;
        }
        .tipo-materia-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        /* Rest of your existing styles */
        .form-box {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }
        .form-box h3 {
            margin: 0 0 15px 0;
            color: var(--text-primary);
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }
        .form-grid input,
        .form-grid select {
            padding: 12px;
            border: 2px solid #444;
            border-radius: 8px;
            font-size: 14px;
            background-color: #2d3436;
            color: var(--text-primary);
            transition: var(--transition);
        }
        .form-grid input:focus,
        .form-grid select:focus {
            border-color: var(--accent);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }
        .materias-selector {
            grid-column: 1 / -1;
            margin-top: 10px;
        }
        .materias-checkbox-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background-color: #2d3436;
            border-radius: 8px;
            border: 1px solid var(--accent);
        }
        .materia-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .materia-checkbox input[type="checkbox"] {
            margin: 0;
        }
        .btn-add {
            padding: 12px 25px;
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .btn-add:hover {
            transform: translateY(-2px);
        }
        .materia-title {
            color: var(--accent);
            font-size: 2em;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
        }
        .fecha-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .fecha-box input {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--accent);
            border-radius: 8px;
            background-color: #2d3436;
            color: var(--text-primary);
            transition: var(--transition);
        }
        .fecha-box input:focus {
            border-color: var(--accent-secondary);
            box-shadow: 0 0 10px rgba(240, 147, 251, 0.5);
        }
        .btn-fecha {
            padding: 10px 20px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .btn-fecha:hover {
            transform: translateY(-2px);
        }
        .btn-delete-fecha {
            padding: 10px 20px;
            background-color: var(--danger);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .btn-delete-fecha:hover {
            transform: translateY(-2px);
        }
        .observaciones-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #444;
            border-radius: 6px;
            font-size: 13px;
            background-color: #2d3436;
            color: var(--text-primary);
            resize: vertical;
            min-height: 40px;
            transition: var(--transition);
        }
        .observaciones-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }
        thead {
            background-color: var(--accent);
            color: white;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #444;
        }
        .check-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: var(--accent);
        }
        .btn-delete {
            padding: 8px 15px;
            background-color: var(--danger);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .btn-delete:hover {
            transform: translateY(-2px);
        }
        .btn-renovar {
            padding: 8px 15px;
            background-color: var(--success);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .btn-renovar:hover {
            transform: translateY(-2px);
        }
        .btn-editar {
            padding: 8px 15px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .btn-editar:hover {
            transform: translateY(-2px);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat {
            padding: 25px;
            border-radius: 12px;
            color: white;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        .stat:hover {
            transform: translateY(-5px);
        }
        .stat h4 {
            font-size: 13px;
            margin: 0 0 10px 0;
            opacity: 0.9;
        }
        .stat p {
            font-size: 36px;
            font-weight: bold;
            margin: 0;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        .empty {
            text-align: center;
            padding: 50px;
            color: var(--text-secondary);
        }
        .hidden {
            display: none;
        }
        .tipo-materia {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .tipo-materia select {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background-color: #2d3436;
            color: var(--text-primary);
            transition: var(--transition);
        }
        .mes-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .mes-selector select {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background-color: #2d3436;
            color: var(--text-primary);
            transition: var(--transition);
        }
        .alumno-form-container {
            background: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }
        .alumno-form-container h3 {
            margin: 0 0 15px 0;
            color: var(--text-primary);
        }
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }
        .modal-content {
            background-color: var(--bg-light);
            margin: 15% auto;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--accent);
            width: 50%;
            max-width: 500px;
            box-shadow: var(--shadow);
        }
        .modal-content h3 {
            color: var(--accent);
            margin-top: 0;
        }
        .modal-content input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background-color: #2d3436;
            color: var(--text-primary);
            transition: var(--transition);
        }
        .modal-content input:focus {
            border-color: var(--accent-secondary);
            box-shadow: 0 0 10px rgba(240, 147, 251, 0.5);
        }
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        .modal-buttons button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        .modal-buttons .confirm {
            background-color: var(--success);
            color: white;
        }
        .modal-buttons .confirm:hover {
            transform: translateY(-2px);
        }
        .modal-buttons .cancel {
            background-color: var(--danger);
            color: white;
        }
        .modal-buttons .cancel:hover {
            transform: translateY(-2px);
        }
        /* Indicadores visuales */
        .estado-carnet {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .estado-verde {
            background-color: var(--success);
        }
        .estado-amarillo {
            background-color: var(--warning);
        }
        .estado-rojo {
            background-color: var(--danger);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <img src="logo-cpu.png"
                     alt="logo CPU" class="logo-cpu">
                Comunidad Pastoral Universitaria
            </h1>
            <p>üìö Control de Asistencia</p>
            <div class="clock" id="clock"></div>
        </div>
        <div class="layout">
            <div class="sidebar">
                <h2>üìã Materias</h2>
                <div class="tipo-materia">
                    <select id="tipoMateria" onchange="render()">
                        <option value="extension">Extensi√≥n Universitaria</option>
                        <option value="taller">Talleres Universitarios</option>
                    </select>
                </div>
                <div class="mes-selector">
                    <select id="mesSelector" onchange="cambiarMes()">
                        <option value="0">Enero</option>
                        <option value="1">Febrero</option>
                        <option value="2">Marzo</option>
                        <option value="3">Abril</option>
                        <option value="4">Mayo</option>
                        <option value="5">Junio</option>
                        <option value="6">Julio</option>
                        <option value="7">Agosto</option>
                        <option value="8">Septiembre</option>
                        <option value="9">Octubre</option>
                        <option value="10">Noviembre</option>
                        <option value="11">Diciembre</option>
                    </select>
                </div>
                <div class="materia-list" id="materiasList"></div>
                <button class="btn-nueva" onclick="mostrarModalTipoMateria()">‚ûï Nueva Materia</button>
                <button class="btn-nueva" onclick="mostrarFormularioAlumno()">‚ûï Nuevo Alumno</button>
            </div>
            <div class="content">
                <div id="alumnoFormContainer" class="hidden">
                    <div class="alumno-form-container">
                        <h3>‚ûï Agregar Nuevo Alumno</h3>
                        <div class="form-grid">
                            <input type="text" id="fn" placeholder="Nombre">
                            <input type="text" id="fa" placeholder="Apellido">
                            <input type="text" id="fd" placeholder="DNI">
                            <input type="text" id="fp" placeholder="Pabell√≥n">
                        </div>
                        <div class="materias-selector">
                            <h4>Seleccionar Materias:</h4>
                            <div class="materias-checkbox-container" id="materiasCheckboxContainer"></div>
                        </div>
                        <button class="btn-add" onclick="addAlumno()">Agregar Alumno</button>
                    </div>
                </div>
                <div id="mainArea">
                    <!-- Aqu√≠ se mostrar√° el carousel o el contenido de la materia -->
                </div>
            </div>
        </div>
    </div>
    <!-- Modal para elegir tipo de materia -->
    <div id="modalTipoMateria" class="modal-tipo">
        <div class="modal-tipo-content">
            <h3>Selecciona el tipo de materia</h3>
            <div class="tipo-materia-options">
                <div class="tipo-materia-option extension" onclick="seleccionarTipoMateria('extension')">
                    Actividad de Extensi√≥n Universitaria
                </div>
                <div class="tipo-materia-option taller" onclick="seleccionarTipoMateria('taller')">
                    Proyecto de Extencion Universitaria
                </div>
            </div>
        </div>
    </div>
    <!-- Modal para nueva materia -->
    <div id="modalMateria" class="modal">
        <div class="modal-content">
            <h3>Nueva Materia</h3>
            <input type="text" id="nombreMateria" placeholder="Nombre de la materia">
            <div class="modal-buttons">
                <button class="cancel" onclick="cerrarModal('modalMateria')">Cancelar</button>
                <button class="confirm" onclick="crearMateria()">Confirmar</button>
            </div>
        </div>
    </div>
    <!-- Modal para eliminar materia -->
    <div id="modalEliminarMateria" class="modal">
        <div class="modal-content">
            <h3>¬øEliminar esta materia?</h3>
            <p id="nombreMateriaEliminar"></p>
            <div class="modal-buttons">
                <button class="cancel" onclick="cerrarModal('modalEliminarMateria')">Cancelar</button>
                <button class="confirm" onclick="confirmarEliminarMateria()">Confirmar</button>
            </div>
        </div>
    </div>
    <!-- Modal para editar alumno -->
    <div id="modalEditarAlumno" class="modal">
        <div class="modal-content">
            <h3>Editar Alumno</h3>
            <input type="text" id="editNombre" placeholder="Nombre">
            <input type="text" id="editApellido" placeholder="Apellido">
            <input type="text" id="editDNI" placeholder="DNI">
            <input type="text" id="editPabellon" placeholder="Pabell√≥n">
            <input type="date" id="editFechaInscripcion" placeholder="Fecha de Inscripci√≥n">
            <input type="date" id="editFechaVencimiento" placeholder="Fecha de Vencimiento">
            <div class="modal-buttons">
                <button class="cancel" onclick="cerrarModal('modalEditarAlumno')">Cancelar</button>
                <button class="confirm" onclick="guardarEdicionAlumno()">Guardar</button>
            </div>
        </div>
    </div>
    <script>
        // Base de datos simulada por mes
        var db = {
            meses: [],
            tipoMateriaActual: 'extension',
            tipoMateriaSeleccionado: null,
            mesActual: 0, // Inicializado en enero
            materiaAEliminar: null,
            alumnoAEditar: null,
            actual: null
        };
        // Inicializar la base de datos por mes
        function initDB() {
            for (let i = 0; i < 12; i++) {
                db.meses.push({
                    id: i,
                    materias: [],
                    alumnos: []
                });
            }
        }
        // Variables para el carousel
        let currentSlide = 0;
        let slides = [];
        let slideInterval;
        // Inicializar la aplicaci√≥n
        function init() {
            initDB();
            // Inicializar con el mes seleccionado en el selector (por defecto, enero)
            db.mesActual = parseInt(document.getElementById('mesSelector').value);
            render();
            updateClock();
            setInterval(updateClock, 1000);
        }
        // Actualizar el reloj
        function updateClock() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            document.getElementById('clock').textContent = now.toLocaleDateString('es-ES', options);
        }
        // Mostrar modal para elegir tipo de materia
        function mostrarModalTipoMateria() {
            document.getElementById('modalTipoMateria').style.display = 'block';
        }
        // Seleccionar tipo de materia
        function seleccionarTipoMateria(tipo) {
            db.tipoMateriaSeleccionado = tipo;
            document.getElementById('modalTipoMateria').style.display = 'none';
            mostrarModalMateria();
        }
        // Mostrar modal para nueva materia
        function mostrarModalMateria() {
            document.getElementById('modalMateria').style.display = 'block';
        }
        // Cerrar modal
        function cerrarModal(id) {
            document.getElementById(id).style.display = 'none';
        }
        // Crear una nueva materia (solo para el mes seleccionado)
        function crearMateria() {
            var nom = document.getElementById('nombreMateria').value.trim();
            if (!nom) {
                alert('Ingresa un nombre para la materia');
                return;
            }
            // Usar el mes seleccionado en el selector
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            db.meses[mesSeleccionado].materias.push({
                id: Date.now(),
                nombre: nom,
                tipo: db.tipoMateriaSeleccionado,
                fechas: ['Clase 1', 'Clase 2', 'Clase 3', 'Clase 4'],
                alumnos: []
            });
            cerrarModal('modalMateria');
            document.getElementById('nombreMateria').value = '';
            render();
        }
        // Mostrar modal para eliminar materia
        function mostrarModalEliminarMateria(id) {
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var materia = db.meses[mesSeleccionado].materias.find(m => m.id === id);
            document.getElementById('nombreMateriaEliminar').textContent = materia.nombre;
            db.materiaAEliminar = id;
            document.getElementById('modalEliminarMateria').style.display = 'block';
        }
        // Confirmar eliminaci√≥n de materia
        function confirmarEliminarMateria() {
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var materiasMesActual = db.meses[mesSeleccionado].materias;
            if (materiasMesActual.length === 1) {
                alert('Debe haber al menos una materia en el mes seleccionado');
                return;
            }
            db.meses[mesSeleccionado].materias = materiasMesActual.filter(m => m.id !== db.materiaAEliminar);
            cerrarModal('modalEliminarMateria');
            render();
        }
        // Ver una materia espec√≠fica (solo del mes seleccionado)
        function verMateria(id) {
            db.actual = id;
            document.getElementById('alumnoFormContainer').classList.add('hidden');
            render();
        }
        // Mostrar el formulario para agregar alumno (solo materias del mes seleccionado)
        function mostrarFormularioAlumno() {
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var materiasMesActual = db.meses[mesSeleccionado].materias;
            var checkboxesHtml = '';
            materiasMesActual.forEach(m => {
                checkboxesHtml += `
                    <div class="materia-checkbox">
                        <input type="checkbox" id="materia-${m.id}" value="${m.id}">
                        <label for="materia-${m.id}">${m.nombre}</label>
                    </div>
                `;
            });
            document.getElementById('materiasCheckboxContainer').innerHTML = checkboxesHtml;
            document.getElementById('alumnoFormContainer').classList.remove('hidden');
            document.getElementById('mainArea').classList.add('hidden');
        }
        // Ocultar el formulario de alumno
        function ocultarFormularioAlumno() {
            document.getElementById('alumnoFormContainer').classList.add('hidden');
            document.getElementById('mainArea').classList.remove('hidden');
        }
        // Agregar un alumno a una o varias materias (solo al mes seleccionado)
        function addAlumno() {
            var n = document.getElementById('fn').value.trim();
            var a = document.getElementById('fa').value.trim();
            var d = document.getElementById('fd').value.trim();
            var p = document.getElementById('fp').value.trim();
            var checkboxes = document.querySelectorAll('#materiasCheckboxContainer input[type="checkbox"]:checked');
            var materiasSeleccionadas = Array.from(checkboxes).map(cb => parseInt(cb.value));
            if (!n || !a || !d || !p || materiasSeleccionadas.length === 0) {
                alert('Completa todos los campos y selecciona al menos una materia');
                return;
            }
            // Usar el mes seleccionado en el selector
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            let alumnoExistente = db.meses[mesSeleccionado].alumnos.find(al => al.dni === d);
            if (!alumnoExistente) {
                alumnoExistente = {
                    id: Date.now(),
                    nombre: n,
                    apellido: a,
                    dni: d,
                    pabellon: p,
                    fecha_inscripcion: new Date().toISOString().split('T')[0],
                    fecha_vencimiento_carnet: new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0]
                };
                db.meses[mesSeleccionado].alumnos.push(alumnoExistente);
            }
            // Agregar el alumno solo a las materias del mes seleccionado
            materiasSeleccionadas.forEach(mid => {
                let materia = db.meses[mesSeleccionado].materias.find(m => m.id === mid);
                if (materia) {
                    if (!materia.alumnos.some(al => al.id === alumnoExistente.id)) {
                        materia.alumnos.push({
                            id: alumnoExistente.id,
                            nombre: alumnoExistente.nombre,
                            apellido: alumnoExistente.apellido,
                            dni: alumnoExistente.dni,
                            pabellon: alumnoExistente.pabellon,
                            fecha_inscripcion: alumnoExistente.fecha_inscripcion,
                            fecha_vencimiento_carnet: alumnoExistente.fecha_vencimiento_carnet,
                            asist: {},
                            observaciones: ''
                        });
                    }
                }
            });
            // Limpiar los campos y ocultar el formulario
            document.getElementById('fn').value = '';
            document.getElementById('fa').value = '';
            document.getElementById('fd').value = '';
            document.getElementById('fp').value = '';
            ocultarFormularioAlumno();
            render();
        }
        // Eliminar un alumno de una materia
        function delAlumno(mid, aid) {
            if (confirm('¬øEliminar alumno?')) {
                var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
                var mat = db.meses[mesSeleccionado].materias.find(m => m.id === mid);
                if (mat) {
                    mat.alumnos = mat.alumnos.filter(a => a.id !== aid);
                    render();
                }
            }
        }
        // Alternar la asistencia de un alumno
        function toggleAsist(mid, aid, f) {
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var mat = db.meses[mesSeleccionado].materias.find(m => m.id === mid);
            if (mat) {
                var al = mat.alumnos.find(a => a.id === aid);
                if (al) {
                    al.asist[f] = !al.asist[f];
                    render();
                }
            }
        }
        // Agregar una nueva fecha/clase
        function addFecha() {
            var f = document.getElementById('ff').value.trim();
            if (!f) return;
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var mat = db.meses[mesSeleccionado].materias.find(m => m.id === db.actual);
            if (mat) {
                mat.fechas.push(f);
                document.getElementById('ff').value = '';
                render();
            }
        }
        // Eliminar una fecha/clase
        function deleteFecha() {
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var mat = db.meses[mesSeleccionado].materias.find(m => m.id === db.actual);
            if (!mat || mat.fechas.length === 0) {
                alert('No hay fechas para eliminar');
                return;
            }
            var opciones = mat.fechas.map((f, i) => `${i + 1}. ${f}`).join('\n');
            var seleccion = prompt('Selecciona el n√∫mero de la fecha a eliminar:\n\n' + opciones);
            if (seleccion) {
                var idx = parseInt(seleccion) - 1;
                if (idx >= 0 && idx < mat.fechas.length) {
                    if (confirm(`¬øEliminar "${mat.fechas[idx]}"?`)) {
                        mat.fechas.splice(idx, 1);
                        render();
                    }
                } else {
                    alert('N√∫mero inv√°lido');
                }
            }
        }
        // Actualizar las observaciones de un alumno
        function updateObservaciones(mid, aid, valor) {
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var mat = db.meses[mesSeleccionado].materias.find(m => m.id === mid);
            if (mat) {
                var al = mat.alumnos.find(a => a.id === aid);
                if (al) {
                    al.observaciones = valor;
                }
            }
        }
        // Cambiar el tipo de materia (Extensi√≥n o Taller)
        function cambiarTipoMateria() {
            db.tipoMateriaActual = document.getElementById('tipoMateria').value;
            render();
        }
        // Cambiar el mes seleccionado (limpia la selecci√≥n actual)
        function cambiarMes() {
            db.mesActual = parseInt(document.getElementById('mesSelector').value);
            db.actual = null;
            ocultarFormularioAlumno();
            render();
        }
        // Funci√≥n para obtener el estado del carnet
        function getEstadoCarnet(fechaVencimiento) {
            const hoy = new Date();
            const vencimiento = new Date(fechaVencimiento);
            const diffTime = vencimiento - hoy;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            if (diffDays < 0) {
                return 'estado-rojo';
            } else if (diffDays <= 15) {
                return 'estado-amarillo';
            } else {
                return 'estado-verde';
            }
        }
        // Funci√≥n para renovar el carnet
        function renovarCarnet(mid, aid) {
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var mat = db.meses[mesSeleccionado].materias.find(m => m.id === mid);
            if (mat) {
                var al = mat.alumnos.find(a => a.id === aid);
                if (al) {
                    al.fecha_vencimiento_carnet = new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0];
                    render();
                }
            }
        }
        // Mostrar modal para editar alumno
        function mostrarModalEditarAlumno(aid) {
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var mat = db.meses[mesSeleccionado].materias.find(m => m.id === db.actual);
            if (mat) {
                var al = mat.alumnos.find(a => a.id === aid);
                if (al) {
                    db.alumnoAEditar = al;
                    document.getElementById('editNombre').value = al.nombre;
                    document.getElementById('editApellido').value = al.apellido;
                    document.getElementById('editDNI').value = al.dni;
                    document.getElementById('editPabellon').value = al.pabellon;
                    document.getElementById('editFechaInscripcion').value = al.fecha_inscripcion;
                    document.getElementById('editFechaVencimiento').value = al.fecha_vencimiento_carnet;
                    document.getElementById('modalEditarAlumno').style.display = 'block';
                }
            }
        }
        // Guardar la edici√≥n del alumno
        function guardarEdicionAlumno() {
            var n = document.getElementById('editNombre').value.trim();
            var a = document.getElementById('editApellido').value.trim();
            var d = document.getElementById('editDNI').value.trim();
            var p = document.getElementById('editPabellon').value.trim();
            var fi = document.getElementById('editFechaInscripcion').value;
            var fv = document.getElementById('editFechaVencimiento').value;
            if (!n || !a || !d || !p || !fi || !fv) {
                alert('Completa todos los campos');
                return;
            }
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var alumno = db.alumnoAEditar;
            alumno.nombre = n;
            alumno.apellido = a;
            alumno.dni = d;
            alumno.pabellon = p;
            alumno.fecha_inscripcion = fi;
            alumno.fecha_vencimiento_carnet = fv;
            // Actualizar en todas las materias del mes seleccionado
            db.meses[mesSeleccionado].materias.forEach(m => {
                var al = m.alumnos.find(a => a.id === alumno.id);
                if (al) {
                    al.nombre = n;
                    al.apellido = a;
                    al.dni = d;
                    al.pabellon = p;
                    al.fecha_inscripcion = fi;
                    al.fecha_vencimiento_carnet = fv;
                }
            });
            cerrarModal('modalEditarAlumno');
            render();
        }
        // Inicializar el carousel
        function initCarousel() {
            slides = [
                {
                    icon: "üìö",
                    title: "La educaci√≥n es el arma m√°s poderosa para cambiar el mundo.",
                    author: "‚Äî Nelson Mandela",
                    background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
                },
                {
                    icon: "ü§ù",
                    title: "La comunidad es el coraz√≥n de la transformaci√≥n social.",
                    author: "‚Äî Paulo Freire",
                    background: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"
                },
                {
                    icon: "‚öñÔ∏è",
                    title: "La igualdad no es un sue√±o, es un derecho que construimos juntos.",
                    author: "‚Äî Rigoberta Mench√∫",
                    background: "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"
                },
                {
                    icon: "üå±",
                    title: "Cultivar la mente es sembrar futuro.",
                    author: "‚Äî Proverbio latinoamericano",
                    background: "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"
                },
                {
                    icon: "üí°",
                    title: "El trabajo en equipo divide el esfuerzo y multiplica los resultados.",
                    author: "‚Äî An√≥nimo",
                    background: "linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"
                },
                {
                    icon: "üåç",
                    title: "La diversidad cultural es el patrimonio m√°s valioso de la humanidad.",
                    author: "‚Äî UNESCO",
                    background: "linear-gradient(135deg, #fab1a0 0%, #e17055 100%)"
                },
                {
                    icon: "üéì",
                    title: "Aprender es descubrir lo que ya sabes. Ense√±ar es recordar a otros que lo saben tanto como t√∫.",
                    author: "‚Äî Richard Bach",
                    background: "linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)"
                },
                {
                    icon: "‚ú®",
                    title: "La creatividad es la inteligencia divirti√©ndose.",
                    author: "‚Äî Albert Einstein",
                    background: "linear-gradient(135deg, #f12711 0%, #f5af19 100%)"
                },
                {
                    icon: "üåü",
                    title: "La excelencia no es un acto, es un h√°bito.",
                    author: "‚Äî Arist√≥teles",
                    background: "linear-gradient(135deg, #5433ff 0%, #20bdff 100%)"
                },
                {
                    icon: "üìñ",
                    title: "Un libro abierto es un cerebro que habla; cerrado, un amigo que espera.",
                    author: "‚Äî Proverbio chino",
                    background: "linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)"
                },
                {
                    icon: "ü§≤",
                    title: "La solidaridad no es un gesto de caridad, es un acto de justicia.",
                    author: "‚Äî Eduardo Galeano",
                    background: "linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)"
                },
                {
                    icon: "üåà",
                    title: "La inclusi√≥n no es un gesto de caridad, es un derecho humano fundamental.",
                    author: "‚Äî Ban Ki-moon",
                    background: "linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)"
                },
                {
                    icon: "üí¨",
                    title: "El di√°logo es el puente entre los corazones y las mentes.",
                    author: "‚Äî Mahatma Gandhi",
                    background: "linear-gradient(135deg, #ff758c 0%, #ff7eb3 100%)"
                },
                {
                    icon: "üåø",
                    title: "La sostenibilidad es el camino hacia un futuro donde todos podamos florecer.",
                    author: "‚Äî Jane Goodall",
                    background: "linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%)"
                },
                {
                    icon: "üöÄ",
                    title: "La innovaci√≥n distingue a un l√≠der de un seguidor.",
                    author: "‚Äî Steve Jobs",
                    background: "linear-gradient(135deg, #7f00ff 0%, #e100ff 100%)"
                }
            ];
            const carouselContainer = document.createElement('div');
            carouselContainer.className = 'carousel-container';
            const slidesContainer = document.createElement('div');
            slidesContainer.className = 'carousel-slides';
            slides.forEach((slide, index) => {
                const slideElement = document.createElement('div');
                slideElement.className = `carousel-slide ${index === 0 ? 'active' : ''}`;
                slideElement.style.background = slide.background;
                slideElement.innerHTML = `
                    <div class="slide-icon">${slide.icon}</div>
                    <h3>${slide.title}</h3>
                    <p>${slide.author}</p>
                `;
                slidesContainer.appendChild(slideElement);
            });
            carouselContainer.appendChild(slidesContainer);
            // Controles del carousel
            const controls = document.createElement('div');
            controls.className = 'carousel-controls';
            controls.innerHTML = `
                <button onclick="prevSlide()">‚ùÆ</button>
                <button onclick="nextSlide()">‚ùØ</button>
            `;
            carouselContainer.appendChild(controls);
            // Indicadores del carousel
            const dots = document.createElement('div');
            dots.className = 'carousel-dots';
            slides.forEach((_, index) => {
                const dot = document.createElement('span');
                dot.onclick = () => goToSlide(index);
                if (index === 0) dot.className = 'active';
                dots.appendChild(dot);
            });
            carouselContainer.appendChild(dots);
            return carouselContainer;
        }
        // Funciones para controlar el carousel
        function nextSlide() {
            slides[currentSlide].classList.remove('active');
            document.querySelectorAll('.carousel-dots span')[currentSlide].classList.remove('active');
            setTimeout(() => {
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
                document.querySelectorAll('.carousel-dots span')[currentSlide].classList.add('active');
            }, 500);
        }
        function prevSlide() {
            slides[currentSlide].classList.remove('active');
            document.querySelectorAll('.carousel-dots span')[currentSlide].classList.remove('active');
            setTimeout(() => {
                currentSlide = (currentSlide - 1 + slides.length) % slides.length;
                slides[currentSlide].classList.add('active');
                document.querySelectorAll('.carousel-dots span')[currentSlide].classList.add('active');
            }, 500);
        }
        function goToSlide(index) {
            slides[currentSlide].classList.remove('active');
            document.querySelectorAll('.carousel-dots span')[currentSlide].classList.remove('active');
            setTimeout(() => {
                currentSlide = index;
                slides[currentSlide].classList.add('active');
                document.querySelectorAll('.carousel-dots span')[currentSlide].classList.add('active');
            }, 500);
        }
        // Renderizar el contenido principal
        function renderContent() {
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var materiasMesActual = db.meses[mesSeleccionado].materias;
            if (materiasMesActual.length === 0 || !db.actual) {
                const carousel = initCarousel();
                document.getElementById('mainArea').innerHTML = '';
                document.getElementById('mainArea').appendChild(carousel);
                const instruction = document.createElement('div');
                instruction.className = 'empty-instruction';
                instruction.innerHTML = `
                    <p>üëÜ <strong>Comienza creando una materia</strong> üëÜ</p>
                    <p>Haz clic en "<strong>Nueva Materia</strong>"</p>
                `;
                document.getElementById('mainArea').appendChild(instruction);
                // Iniciar el intervalo del carousel
                slides = document.querySelectorAll('.carousel-slide');
                clearInterval(slideInterval);
                slideInterval = setInterval(nextSlide, 10000); // Cambia cada 10 segundos
                return;
            }
            // Si hay una materia seleccionada, mostrar su contenido
            var mat = db.meses[mesSeleccionado].materias.find(m => m.id === db.actual);
            if (!mat) return;
            var html = `
                <h2 class="materia-title">üìñ ${mat.nombre}</h2>
                <div class="fecha-box">
                    <input type="text" id="ff" placeholder="Nueva fecha">
                    <button class="btn-fecha" onclick="addFecha()">‚ûï Agregar Columna</button>
                    <button class="btn-delete-fecha" onclick="deleteFecha()">üóëÔ∏è Eliminar Columna</button>
                </div>`;
            if (!mat.alumnos || mat.alumnos.length === 0) {
                html += '<div class="empty">No hay alumnos</div>';
            } else {
                html += '<table><thead><tr><th>Nombre</th><th>Apellido</th><th>DNI</th><th>Pabell√≥n</th><th>Fecha Inscripci√≥n</th><th>Fecha Vencimiento</th><th>Estado</th>';
                mat.fechas.forEach(f => {
                    html += `<th>${f}</th>`;
                });
                html += '<th>Observaciones</th><th>Acciones</th></tr></thead><tbody>';
                mat.alumnos.forEach(al => {
                    const estadoCarnet = getEstadoCarnet(al.fecha_vencimiento_carnet);
                    html += `<tr><td><b>${al.nombre}</b></td><td>${al.apellido}</td><td>${al.dni}</td><td>${al.pabellon}</td>
                    <td>${al.fecha_inscripcion}</td>
                    <td>${al.fecha_vencimiento_carnet}</td>
                    <td><span class="estado-carnet ${estadoCarnet}"></span></td>`;
                    mat.fechas.forEach(f => {
                        var chk = al.asist[f] ? 'checked' : '';
                        var ico = al.asist[f] ? '‚úÖ' : '‚ùå';
                        html += `<td><div class="check-box">
                            <input type="checkbox" ${chk} onclick="toggleAsist(${mat.id},${al.id},'${f}')">
                            <span>${ico}</span>
                        </div></td>`;
                    });
                    html += `<td><textarea class="observaciones-input"
                        placeholder="Escribir observaciones..."
                        onchange="updateObservaciones(${mat.id},${al.id},this.value)">${al.observaciones || ''}</textarea></td>
                    <td>
                        <button class="btn-renovar" onclick="renovarCarnet(${mat.id},${al.id})">Renovar</button>
                        <button class="btn-editar" onclick="mostrarModalEditarAlumno(${al.id})">Editar</button>
                        <button class="btn-delete" onclick="delAlumno(${mat.id},${al.id})">Eliminar</button>
                    </td></tr>`;
                });
                html += '</tbody></table>';
                // Estad√≠sticas por alumno
                mat.alumnos.forEach(al => {
                    var totalAsistencias = Object.values(al.asist).filter(Boolean).length;
                    var totalClases = mat.fechas.length;
                    var porcentajeAsistencia = totalClases > 0 ? ((totalAsistencias / totalClases) * 100).toFixed(1) : 0;
                    html += `<div class="stats">
                        <div class="stat" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <h4>Asistencias</h4>
                            <p>${totalAsistencias}</p>
                        </div>
                        <div class="stat" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <h4>Clases</h4>
                            <p>${totalClases}</p>
                        </div>
                        <div class="stat" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <h4>% Asistencia</h4>
                            <p>${porcentajeAsistencia}%</p>
                        </div>
                    </div>`;
                });
            }
            document.getElementById('mainArea').innerHTML = html;
        }
        // Renderizar la barra lateral con las materias del mes seleccionado
        function renderSidebar() {
            var tipoActual = document.getElementById('tipoMateria').value;
            var mesSeleccionado = parseInt(document.getElementById('mesSelector').value);
            var materiasFiltradas = db.meses[mesSeleccionado].materias.filter(m => m.tipo === tipoActual);
            var html = '';
            if (materiasFiltradas.length === 0) {
                html = '<p style="color:#999;text-align:center;padding:20px;">Sin materias</p>';
            } else {
                materiasFiltradas.forEach(m => {
                    var active = m.id === db.actual ? 'active' : '';
                    html += `<div class="materia-item">
                        <button class="materia-btn ${active}" onclick="verMateria(${m.id})">${m.nombre}</button>`;
                    if (materiasFiltradas.length > 1) {
                        html += `<button class="delete-materia" onclick="mostrarModalEliminarMateria(${m.id})">√ó</button>`;
                    }
                    html += '</div>';
                });
            }
            document.getElementById('materiasList').innerHTML = html;
        }
        // Funci√≥n principal para renderizar todo
        function render() {
            renderSidebar();
            renderContent();
        }
        // Inicializar la aplicaci√≥n
        init();
    </script>
</body>
</html>


